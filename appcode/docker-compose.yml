services:
  db:
    image: postgres:15-alpine
    container_name: local_postgres
    environment:
      POSTGRES_USER: local_user
      POSTGRES_PASSWORD: local_password
      POSTGRES_DB: local_db
    ports:
      - "5432:5432"
    volumes:
      # Adjusted path to match root location
      - ./backend/db_init:/docker-entrypoint-initdb.d:ro

  api:
    build:
      context: ./backend  # Looks for Dockerfile inside backend folder
    container_name: fastapi_backend
    ports:
      - "7071:80"
    environment:
      - DATABASE_URL=postgres://local_user:local_password@db:5432/local_db
      - DB_SSL_MODE=disable
    depends_on:
      - db

  frontend:
    build:
      context: ./frontend  # Looks for Dockerfile inside frontend folder
      args:
        - REACT_APP_API_BASE_URL=http://localhost:7071/api      
    container_name: react_frontend
    ports:
      - "3000:80"
    depends_on:
      - api
